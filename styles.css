:root{
  --bg:#f6f7f9; --card:#ffffff; --border:#e5e7eb; --text:#111827; --muted:#6b7280;
  --accent:#0f172a; --danger:#b91c1c; --warn:#b45309; --ok:#047857;
  --radius:12px;
}
*{ box-sizing:border-box; }
body{
  margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--bg); color:var(--text);
}
.topbar{
  position:sticky; top:0; z-index:20;
  display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
  padding:10px 12px; background:var(--card); border-bottom:1px solid var(--border);
}
.top-left, .top-right{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }

button{
  height:38px; padding:0 12px;
  border-radius:10px; border:1px solid var(--border);
  background:#fff; color:var(--text);
}
button.primary{ background:var(--accent); border-color:var(--accent); color:#fff; }
button.danger{ border-color:var(--danger); color:var(--danger); }
button.subtle{ background:#fff; }
button.danger.subtle{ border-style:dashed; }
button:disabled{ opacity:.55; }

.pill{
  padding:6px 10px; border-radius:999px;
  border:1px solid var(--border); background:#fff; font-size:12px;
}
.pill.muted{ color:var(--muted); }

.layout{
  display:grid; grid-template-columns:1fr 1.1fr; gap:12px;
  padding:12px; max-width:1500px; margin:0 auto;
}
@media (max-width:980px){ .layout{ grid-template-columns:1fr; } }

.card{
  background:var(--card); border:1px solid var(--border);
  border-radius:var(--radius); overflow:hidden;
}
.card h2{ margin:0; padding:12px; border-bottom:1px solid var(--border); font-size:15px; }
.pad{ padding:12px; }

label{ display:block; font-size:13px; margin:10px 0 6px; }
input, select{
  width:100%; padding:10px;
  border:1px solid var(--border); border-radius:10px;
  font:inherit; background:#fff;
}
.small{ font-size:12px; color:var(--muted); }

.divider{ height:1px; background:var(--border); margin:14px 0; }

.subhead{ margin:0 0 8px; font-size:13px; color:rgba(17,24,39,.85); }

/* Checkpoints */
.cp{
  border:1px solid var(--border); border-radius:12px;
  padding:10px; margin-top:10px; background:#fff;
}
.cpHead{ display:flex; justify-content:space-between; gap:10px; align-items:flex-start; }
.cpTitle{ font-weight:700; font-size:13px; }
.cpMeta{ font-size:12px; color:var(--muted); }
.cpStatus{
  font-size:12px; padding:4px 8px; border-radius:999px;
  border:1px solid var(--border); white-space:nowrap;
}
.cpStatus.ok{ border-color:var(--ok); color:var(--ok); }
.cpStatus.bad{ border-color:var(--danger); color:var(--danger); }
.cpStatus.lock{ color:var(--muted); }

.chips{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
.chip{
  border:1px solid var(--border);
  border-radius:999px;
  padding:8px 10px;
  font-size:12px;
  background:#fff;
}
.chip.selected{ border-color:var(--accent); }

.cpActions{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; align-items:center; }
.notice{
  margin-top:10px;
  padding:8px 10px;
  border-radius:10px;
  border:1px dashed var(--border);
  font-size:12px;
}
.notice.bad{ border-color:rgba(185,28,28,.35); color:var(--danger); background:rgba(185,28,28,.04); }
.notice.warn{ border-color:rgba(180,83,9,.35); color:var(--warn); background:rgba(180,83,9,.04); }
.notice.ok{ border-color:rgba(4,120,87,.35); color:var(--ok); background:rgba(4,120,87,.04); }
.hint{ margin-top:10px; padding:8px 10px; border-radius:10px; background:#f9fafb; border:1px solid var(--border); font-size:12px; }

/* Feedback */
.feedback{
  padding:10px; border-radius:12px;
  border:1px dashed var(--border);
  background:#fff;
}
.fb{ margin:6px 0; font-size:13px; }
.fb.ok{ color:var(--ok); }
.fb.warn{ color:var(--warn); }
.fb.bad{ color:var(--danger); }

/* Drawing */
.toolbar{
  display:flex; flex-wrap:wrap; gap:8px; align-items:center;
  padding:10px; border:1px solid var(--border); border-radius:12px;
  background:#fff;
}
.stageWrap{ margin-top:12px; }
.stageHint{ font-size:12px; color:rgba(17,24,39,.75); margin-bottom:8px; }
.stage{
  position:relative;
  border:1px solid var(--border);
  border-radius:12px;
  overflow:hidden;
  background:
    linear-gradient(#fff,#fff),
    radial-gradient(circle at 1px 1px, rgba(17,24,39,.08) 1px, transparent 0);
  background-size:auto, 18px 18px;
  touch-action:none; /* standard stylus-friendly pattern */
}
canvas{ display:block; width:100%; height:auto; }

/* Mapping */
.mapPanel{
  margin-top:12px;
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
  background:#fff;
}
.mapHeader{ display:flex; justify-content:space-between; gap:10px; align-items:baseline; }
.mapControls{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-top:10px; }
.mapControls select{ min-width:240px; }

.marker{
  position:absolute;
  transform:translate(-50%,-50%);
  width:24px; height:24px;
  border-radius:999px;
  border:2px solid rgba(15,23,42,.9);
  background:rgba(255,255,255,.92);
  color:#0f172a;
  font-size:12px;
  display:flex; align-items:center; justify-content:center;
  pointer-events:none;
}
